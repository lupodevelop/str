-module(str_ffi).
-export([decompose_nfd/1, remove_combining_marks/1, translit_replacements/0]).

%% @doc Decompose a string into NFD (Canonical Decomposition) form.
%% Converts characters like 'é' into base + combining mark ('e' + '´').
decompose_nfd(Str) when is_binary(Str) ->
    unicode:characters_to_nfd_binary(Str).

%% @doc Remove combining marks from a string.
%% Filters out code points in all Unicode combining mark ranges:
%%   U+0300-U+036F  Combining Diacritical Marks
%%   U+1AB0-U+1AFF  Combining Diacritical Marks Extended
%%   U+1DC0-U+1DFF  Combining Diacritical Marks Supplement
%%   U+20D0-U+20FF  Combining Diacritical Marks for Symbols
%%   U+FE20-U+FE2F  Combining Half Marks
remove_combining_marks(Str) when is_binary(Str) ->
    unicode:characters_to_binary(
        [CP || CP <- unicode:characters_to_list(Str),
               not is_combining_mark(CP)]
    ).

is_combining_mark(CP) when CP >= 16#0300, CP =< 16#036F -> true;
is_combining_mark(CP) when CP >= 16#1AB0, CP =< 16#1AFF -> true;
is_combining_mark(CP) when CP >= 16#1DC0, CP =< 16#1DFF -> true;
is_combining_mark(CP) when CP >= 16#20D0, CP =< 16#20FF -> true;
is_combining_mark(CP) when CP >= 16#FE20, CP =< 16#FE2F -> true;
is_combining_mark(_) -> false.

%% @doc Return the comprehensive transliteration replacement table.
%% Returns a list of {From, To} tuples for character replacement.
translit_replacements() ->
    [
        {<<"À"/utf8>>, <<"A">>},
        {<<"Á"/utf8>>, <<"A">>},
        {<<"Â"/utf8>>, <<"A">>},
        {<<"Ã"/utf8>>, <<"A">>},
        {<<"Ä"/utf8>>, <<"A">>},
        {<<"Å"/utf8>>, <<"A">>},
        {<<"à"/utf8>>, <<"a">>},
        {<<"á"/utf8>>, <<"a">>},
        {<<"â"/utf8>>, <<"a">>},
        {<<"ã"/utf8>>, <<"a">>},
        {<<"ä"/utf8>>, <<"a">>},
        {<<"å"/utf8>>, <<"a">>},
        {<<"Ç"/utf8>>, <<"C">>},
        {<<"ç"/utf8>>, <<"c">>},
        {<<"È"/utf8>>, <<"E">>},
        {<<"É"/utf8>>, <<"E">>},
        {<<"Ê"/utf8>>, <<"E">>},
        {<<"Ë"/utf8>>, <<"E">>},
        {<<"è"/utf8>>, <<"e">>},
        {<<"é"/utf8>>, <<"e">>},
        {<<"ê"/utf8>>, <<"e">>},
        {<<"ë"/utf8>>, <<"e">>},
        {<<"Ì"/utf8>>, <<"I">>},
        {<<"Í"/utf8>>, <<"I">>},
        {<<"Î"/utf8>>, <<"I">>},
        {<<"Ï"/utf8>>, <<"I">>},
        {<<"ì"/utf8>>, <<"i">>},
        {<<"í"/utf8>>, <<"i">>},
        {<<"î"/utf8>>, <<"i">>},
        {<<"ï"/utf8>>, <<"i">>},
        {<<"Ð"/utf8>>, <<"D">>},
        {<<"ð"/utf8>>, <<"d">>},
        {<<"Ñ"/utf8>>, <<"N">>},
        {<<"ñ"/utf8>>, <<"n">>},
        {<<"Ò"/utf8>>, <<"O">>},
        {<<"Ó"/utf8>>, <<"O">>},
        {<<"Ô"/utf8>>, <<"O">>},
        {<<"Õ"/utf8>>, <<"O">>},
        {<<"Ö"/utf8>>, <<"O">>},
        {<<"Ø"/utf8>>, <<"O">>},
        {<<"ò"/utf8>>, <<"o">>},
        {<<"ó"/utf8>>, <<"o">>},
        {<<"ô"/utf8>>, <<"o">>},
        {<<"õ"/utf8>>, <<"o">>},
        {<<"ö"/utf8>>, <<"o">>},
        {<<"ø"/utf8>>, <<"o">>},
        {<<"Ù"/utf8>>, <<"U">>},
        {<<"Ú"/utf8>>, <<"U">>},
        {<<"Û"/utf8>>, <<"U">>},
        {<<"Ü"/utf8>>, <<"U">>},
        {<<"ù"/utf8>>, <<"u">>},
        {<<"ú"/utf8>>, <<"u">>},
        {<<"û"/utf8>>, <<"u">>},
        {<<"ü"/utf8>>, <<"u">>},
        {<<"Ý"/utf8>>, <<"Y">>},
        {<<"ý"/utf8>>, <<"y">>},
        {<<"ÿ"/utf8>>, <<"y">>},
        {<<"Þ"/utf8>>, <<"TH">>},
        {<<"þ"/utf8>>, <<"th">>},
        {<<"ß"/utf8>>, <<"ss">>},
        {<<"Æ"/utf8>>, <<"AE">>},
        {<<"æ"/utf8>>, <<"ae">>},
        {<<"Œ"/utf8>>, <<"OE">>},
        {<<"œ"/utf8>>, <<"oe">>},
        {<<"Ā"/utf8>>, <<"A">>},
        {<<"ā"/utf8>>, <<"a">>},
        {<<"Ă"/utf8>>, <<"A">>},
        {<<"ă"/utf8>>, <<"a">>},
        {<<"Ą"/utf8>>, <<"A">>},
        {<<"ą"/utf8>>, <<"a">>},
        {<<"Ć"/utf8>>, <<"C">>},
        {<<"ć"/utf8>>, <<"c">>},
        {<<"Ĉ"/utf8>>, <<"C">>},
        {<<"ĉ"/utf8>>, <<"c">>},
        {<<"Ċ"/utf8>>, <<"C">>},
        {<<"ċ"/utf8>>, <<"c">>},
        {<<"Č"/utf8>>, <<"C">>},
        {<<"č"/utf8>>, <<"c">>},
        {<<"Ď"/utf8>>, <<"D">>},
        {<<"ď"/utf8>>, <<"d">>},
        {<<"Đ"/utf8>>, <<"D">>},
        {<<"đ"/utf8>>, <<"d">>},
        {<<"Ē"/utf8>>, <<"E">>},
        {<<"ē"/utf8>>, <<"e">>},
        {<<"Ĕ"/utf8>>, <<"E">>},
        {<<"ĕ"/utf8>>, <<"e">>},
        {<<"Ė"/utf8>>, <<"E">>},
        {<<"ė"/utf8>>, <<"e">>},
        {<<"Ę"/utf8>>, <<"E">>},
        {<<"ę"/utf8>>, <<"e">>},
        {<<"Ě"/utf8>>, <<"E">>},
        {<<"ě"/utf8>>, <<"e">>},
        {<<"Ĝ"/utf8>>, <<"G">>},
        {<<"ĝ"/utf8>>, <<"g">>},
        {<<"Ğ"/utf8>>, <<"G">>},
        {<<"ğ"/utf8>>, <<"g">>},
        {<<"Ġ"/utf8>>, <<"G">>},
        {<<"ġ"/utf8>>, <<"g">>},
        {<<"Ģ"/utf8>>, <<"G">>},
        {<<"ģ"/utf8>>, <<"g">>},
        {<<"Ĥ"/utf8>>, <<"H">>},
        {<<"ĥ"/utf8>>, <<"h">>},
        {<<"Ħ"/utf8>>, <<"H">>},
        {<<"ħ"/utf8>>, <<"h">>},
        {<<"Ĩ"/utf8>>, <<"I">>},
        {<<"ĩ"/utf8>>, <<"i">>},
        {<<"Ī"/utf8>>, <<"I">>},
        {<<"ī"/utf8>>, <<"i">>},
        {<<"Ĭ"/utf8>>, <<"I">>},
        {<<"ĭ"/utf8>>, <<"i">>},
        {<<"Į"/utf8>>, <<"I">>},
        {<<"į"/utf8>>, <<"i">>},
        {<<"İ"/utf8>>, <<"I">>},
        {<<"ı"/utf8>>, <<"i">>},
        {<<"Ĵ"/utf8>>, <<"J">>},
        {<<"ĵ"/utf8>>, <<"j">>},
        {<<"Ķ"/utf8>>, <<"K">>},
        {<<"ķ"/utf8>>, <<"k">>},
        {<<"Ĺ"/utf8>>, <<"L">>},
        {<<"ĺ"/utf8>>, <<"l">>},
        {<<"Ļ"/utf8>>, <<"L">>},
        {<<"ļ"/utf8>>, <<"l">>},
        {<<"Ľ"/utf8>>, <<"L">>},
        {<<"ľ"/utf8>>, <<"l">>},
        {<<"Ŀ"/utf8>>, <<"L">>},
        {<<"ŀ"/utf8>>, <<"l">>},
        {<<"Ł"/utf8>>, <<"L">>},
        {<<"ł"/utf8>>, <<"l">>},
        {<<"Ń"/utf8>>, <<"N">>},
        {<<"ń"/utf8>>, <<"n">>},
        {<<"Ņ"/utf8>>, <<"N">>},
        {<<"ņ"/utf8>>, <<"n">>},
        {<<"Ň"/utf8>>, <<"N">>},
        {<<"ň"/utf8>>, <<"n">>},
        {<<"Ō"/utf8>>, <<"O">>},
        {<<"ō"/utf8>>, <<"o">>},
        {<<"Ŏ"/utf8>>, <<"O">>},
        {<<"ŏ"/utf8>>, <<"o">>},
        {<<"Ő"/utf8>>, <<"O">>},
        {<<"ő"/utf8>>, <<"o">>},
        {<<"Ŕ"/utf8>>, <<"R">>},
        {<<"ŕ"/utf8>>, <<"r">>},
        {<<"Ŗ"/utf8>>, <<"R">>},
        {<<"ŗ"/utf8>>, <<"r">>},
        {<<"Ř"/utf8>>, <<"R">>},
        {<<"ř"/utf8>>, <<"r">>},
        {<<"Ś"/utf8>>, <<"S">>},
        {<<"ś"/utf8>>, <<"s">>},
        {<<"Ŝ"/utf8>>, <<"S">>},
        {<<"ŝ"/utf8>>, <<"s">>},
        {<<"Ş"/utf8>>, <<"S">>},
        {<<"ş"/utf8>>, <<"s">>},
        {<<"Š"/utf8>>, <<"S">>},
        {<<"š"/utf8>>, <<"s">>},
        {<<"Ţ"/utf8>>, <<"T">>},
        {<<"ţ"/utf8>>, <<"t">>},
        {<<"Ť"/utf8>>, <<"T">>},
        {<<"ť"/utf8>>, <<"t">>},
        {<<"Ŧ"/utf8>>, <<"T">>},
        {<<"ŧ"/utf8>>, <<"t">>},
        {<<"Ũ"/utf8>>, <<"U">>},
        {<<"ũ"/utf8>>, <<"u">>},
        {<<"Ū"/utf8>>, <<"U">>},
        {<<"ū"/utf8>>, <<"u">>},
        {<<"Ŭ"/utf8>>, <<"U">>},
        {<<"ŭ"/utf8>>, <<"u">>},
        {<<"Ů"/utf8>>, <<"U">>},
        {<<"ů"/utf8>>, <<"u">>},
        {<<"Ű"/utf8>>, <<"U">>},
        {<<"ű"/utf8>>, <<"u">>},
        {<<"Ų"/utf8>>, <<"U">>},
        {<<"ų"/utf8>>, <<"u">>},
        {<<"Ŵ"/utf8>>, <<"W">>},
        {<<"ŵ"/utf8>>, <<"w">>},
        {<<"Ŷ"/utf8>>, <<"Y">>},
        {<<"ŷ"/utf8>>, <<"y">>},
        {<<"Ÿ"/utf8>>, <<"Y">>},
        {<<"Ź"/utf8>>, <<"Z">>},
        {<<"ź"/utf8>>, <<"z">>},
        {<<"Ż"/utf8>>, <<"Z">>},
        {<<"ż"/utf8>>, <<"z">>},
        {<<"Ž"/utf8>>, <<"Z">>},
        {<<"ž"/utf8>>, <<"z">>},
        {<<"Ș"/utf8>>, <<"S">>},
        {<<"ș"/utf8>>, <<"s">>},
        {<<"Ț"/utf8>>, <<"T">>},
        {<<"ț"/utf8>>, <<"t">>},
        {<<"€"/utf8>>, <<"EUR">>},
        {<<"£"/utf8>>, <<"GBP">>},
        {<<"¥"/utf8>>, <<"YEN">>},
        {<<"¢"/utf8>>, <<"cent">>},
        {<<"¤"/utf8>>, <<"currency">>},
        {<<"₹"/utf8>>, <<"INR">>},
        {<<"₽"/utf8>>, <<"RUB">>},
        {<<"₴"/utf8>>, <<"UAH">>},
        {<<"Α"/utf8>>, <<"A">>},
        {<<"α"/utf8>>, <<"a">>},
        {<<"Β"/utf8>>, <<"B">>},
        {<<"β"/utf8>>, <<"b">>},
        {<<"Γ"/utf8>>, <<"G">>},
        {<<"γ"/utf8>>, <<"g">>},
        {<<"Δ"/utf8>>, <<"D">>},
        {<<"δ"/utf8>>, <<"d">>},
        {<<"Ε"/utf8>>, <<"E">>},
        {<<"ε"/utf8>>, <<"e">>},
        {<<"Ζ"/utf8>>, <<"Z">>},
        {<<"ζ"/utf8>>, <<"z">>},
        {<<"Η"/utf8>>, <<"H">>},
        {<<"η"/utf8>>, <<"h">>},
        {<<"Θ"/utf8>>, <<"TH">>},
        {<<"θ"/utf8>>, <<"th">>},
        {<<"Ι"/utf8>>, <<"I">>},
        {<<"ι"/utf8>>, <<"i">>},
        {<<"Κ"/utf8>>, <<"K">>},
        {<<"κ"/utf8>>, <<"k">>},
        {<<"Λ"/utf8>>, <<"L">>},
        {<<"λ"/utf8>>, <<"l">>},
        {<<"Μ"/utf8>>, <<"M">>},
        {<<"μ"/utf8>>, <<"m">>},
        {<<"Ν"/utf8>>, <<"N">>},
        {<<"ν"/utf8>>, <<"n">>},
        {<<"Ξ"/utf8>>, <<"KS">>},
        {<<"ξ"/utf8>>, <<"ks">>},
        {<<"Ο"/utf8>>, <<"O">>},
        {<<"ο"/utf8>>, <<"o">>},
        {<<"Π"/utf8>>, <<"P">>},
        {<<"π"/utf8>>, <<"p">>},
        {<<"Ρ"/utf8>>, <<"R">>},
        {<<"ρ"/utf8>>, <<"r">>},
        {<<"Σ"/utf8>>, <<"S">>},
        {<<"σ"/utf8>>, <<"s">>},
        {<<"ς"/utf8>>, <<"s">>},
        {<<"Τ"/utf8>>, <<"T">>},
        {<<"τ"/utf8>>, <<"t">>},
        {<<"Υ"/utf8>>, <<"Y">>},
        {<<"υ"/utf8>>, <<"y">>},
        {<<"Φ"/utf8>>, <<"F">>},
        {<<"φ"/utf8>>, <<"f">>},
        {<<"Χ"/utf8>>, <<"CH">>},
        {<<"χ"/utf8>>, <<"ch">>},
        {<<"Ψ"/utf8>>, <<"PS">>},
        {<<"ψ"/utf8>>, <<"ps">>},
        {<<"Ω"/utf8>>, <<"O">>},
        {<<"ω"/utf8>>, <<"o">>},
        {<<"А"/utf8>>, <<"A">>},
        {<<"а"/utf8>>, <<"a">>},
        {<<"Б"/utf8>>, <<"B">>},
        {<<"б"/utf8>>, <<"b">>},
        {<<"В"/utf8>>, <<"V">>},
        {<<"в"/utf8>>, <<"v">>},
        {<<"Г"/utf8>>, <<"G">>},
        {<<"г"/utf8>>, <<"g">>},
        {<<"Д"/utf8>>, <<"D">>},
        {<<"д"/utf8>>, <<"d">>},
        {<<"Е"/utf8>>, <<"E">>},
        {<<"е"/utf8>>, <<"e">>},
        {<<"Ё"/utf8>>, <<"Yo">>},
        {<<"ё"/utf8>>, <<"yo">>},
        {<<"Ж"/utf8>>, <<"Zh">>},
        {<<"ж"/utf8>>, <<"zh">>},
        {<<"З"/utf8>>, <<"Z">>},
        {<<"з"/utf8>>, <<"z">>},
        {<<"И"/utf8>>, <<"I">>},
        {<<"и"/utf8>>, <<"i">>},
        {<<"Й"/utf8>>, <<"Y">>},
        {<<"й"/utf8>>, <<"y">>},
        {<<"К"/utf8>>, <<"K">>},
        {<<"к"/utf8>>, <<"k">>},
        {<<"Л"/utf8>>, <<"L">>},
        {<<"л"/utf8>>, <<"l">>},
        {<<"М"/utf8>>, <<"M">>},
        {<<"м"/utf8>>, <<"m">>},
        {<<"Н"/utf8>>, <<"N">>},
        {<<"н"/utf8>>, <<"n">>},
        {<<"О"/utf8>>, <<"O">>},
        {<<"о"/utf8>>, <<"o">>},
        {<<"П"/utf8>>, <<"P">>},
        {<<"п"/utf8>>, <<"p">>},
        {<<"Р"/utf8>>, <<"R">>},
        {<<"р"/utf8>>, <<"r">>},
        {<<"С"/utf8>>, <<"S">>},
        {<<"с"/utf8>>, <<"s">>},
        {<<"Т"/utf8>>, <<"T">>},
        {<<"т"/utf8>>, <<"t">>},
        {<<"У"/utf8>>, <<"U">>},
        {<<"у"/utf8>>, <<"u">>},
        {<<"Ф"/utf8>>, <<"F">>},
        {<<"ф"/utf8>>, <<"f">>},
        {<<"Х"/utf8>>, <<"Kh">>},
        {<<"х"/utf8>>, <<"kh">>},
        {<<"Ц"/utf8>>, <<"Ts">>},
        {<<"ц"/utf8>>, <<"ts">>},
        {<<"Ч"/utf8>>, <<"Ch">>},
        {<<"ч"/utf8>>, <<"ch">>},
        {<<"Ш"/utf8>>, <<"Sh">>},
        {<<"ш"/utf8>>, <<"sh">>},
        {<<"Щ"/utf8>>, <<"Shch">>},
        {<<"щ"/utf8>>, <<"shch">>},
        {<<"Ъ"/utf8>>, <<"">>},
        {<<"ъ"/utf8>>, <<"">>},
        {<<"Ы"/utf8>>, <<"Y">>},
        {<<"ы"/utf8>>, <<"y">>},
        {<<"Ь"/utf8>>, <<"">>},
        {<<"ь"/utf8>>, <<"">>},
        {<<"Э"/utf8>>, <<"E">>},
        {<<"э"/utf8>>, <<"e">>},
        {<<"Ю"/utf8>>, <<"Yu">>},
        {<<"ю"/utf8>>, <<"yu">>},
        {<<"Я"/utf8>>, <<"Ya">>},
        {<<"я"/utf8>>, <<"ya">>},
        {<<"×"/utf8>>, <<"x">>},
        {<<"÷"/utf8>>, <<"/">>},
        {<<"±"/utf8>>, <<"+/-">>},
        {<<"≤"/utf8>>, <<"<=">>},
        {<<"≥"/utf8>>, <<">=">>},
        {<<"–"/utf8>>, <<"-">>},
        {<<"—"/utf8>>, <<"-">>},
        {<<"‐"/utf8>>, <<"-">>},
        {<<"‑"/utf8>>, <<"-">>},
        {<<"©"/utf8>>, <<"(c)">>},
        {<<"®"/utf8>>, <<"(r)">>},
        {<<"°"/utf8>>, <<"deg">>},
        {<<"•"/utf8>>, <<"*">>},
        {<<"·"/utf8>>, <<".">>}
    ].
